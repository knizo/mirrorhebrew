<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>היפוך כתב מראה בעברית | Mirror Hebrew Converter</title>
  <meta name="description" content="כלי אונליין חינמי שממיר טקסט עברי שנכתב בכתב מראה לטקסט תקין. עובד שורה-שורה או כל הטקסט, כולל שמירה על מספרים ואנגלית." />
  <link rel="canonical" href="https://mirrorhebrew.knizo.com/" />
  <meta name="robots" content="index,follow" />

  <meta property="og:title" content="היפוך כתב מראה בעברית" />
  <meta property="og:description" content="הדבק טקסט בכתב מראה וקבל טקסט תקין בלחיצה." />
  <meta property="og:url" content="https://mirrorhebrew.knizo.com/" />
  <meta property="og:type" content="website" />

  <link rel="stylesheet" href="./styles.css">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WX5D24RT8M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WX5D24RT8M');
  </script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>כלי להפיכת עברית “כתב מראה” לטקסט תקין</h1>
      <p class="muted">
        לרוב “כתב מראה” אומר שכל שורה הוקלדה הפוך. לכן ברירת המחדל: <b>היפוך לכל שורה בנפרד</b>.
      </p>

      <!-- Sticky toolbar (mobile-friendly) -->
      <div class="toolbar">
        <div class="controls">
          <button class="btn primary" id="btnConvert">המר</button>
          <button class="btn" id="btnSwap">החלף בין השדות</button>
          <button class="btn" id="btnCopy">העתק תוצאה</button>
          <button class="btn" id="btnClear">נקה</button>

          <label class="opt">
            <input type="radio" name="mode" value="lines" checked />
            היפוך בכל שורה בנפרד
          </label>

          <label class="opt">
            <input type="radio" name="mode" value="all" />
            היפוך כל הטקסט
          </label>

          <label class="opt" title="משאיר מספרים/אנגלית בכיוון הנכון (לא הופך אותם יחד עם העברית)">
            <input type="checkbox" id="keepLatinNums" checked />
            לא להפוך מספרים/אנגלית
          </label>

          <label class="opt" title="מצב כהה">
            <input type="checkbox" id="darkModeToggle" />
            מצב כהה
          </label>
        </div>
      </div>

      <div class="grid">
        <div>
          <p><b>קלט (כתב מראה)</b></p>
          <textarea id="input" placeholder="הדבק כאן טקסט עברי הפוך..."></textarea>
        </div>
        <div>
          <p><b>פלט (תקין)</b></p>
          <textarea id="output" placeholder="כאן תופיע התוצאה..." readonly></textarea>
        </div>
      </div>

      <div style="margin-top:10px;">
        <div class="status" id="status"></div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ---------- Dark mode (must be inside <script>) ----------
    (function initTheme(){
      const key = "theme";
      const toggle = $("darkModeToggle");
      const root = document.documentElement;

      const systemPrefersDark = () =>
        window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;

      const apply = (theme) => {
        root.setAttribute("data-theme", theme);
        root.style.colorScheme = theme === "dark" ? "dark" : "light";
        if (toggle) toggle.checked = (theme === "dark");
      };

      const saved = localStorage.getItem(key);
      const initial = saved || (systemPrefersDark() ? "dark" : "light");
      apply(initial);

      if (toggle) {
        toggle.addEventListener("change", () => {
          const t = toggle.checked ? "dark" : "light";
          localStorage.setItem(key, t);
          apply(t);
        });
      }

      if (!saved && window.matchMedia) {
        const mq = window.matchMedia("(prefers-color-scheme: dark)");
        mq.addEventListener?.("change", () => apply(systemPrefersDark() ? "dark" : "light"));
      }
    })();

    // ---------- Converter logic ----------
    function reverseString(str) {
      return Array.from(str).reverse().join("");
    }

    function smartReverseLine(line) {
      const re = /[A-Za-z0-9@#%&*()_\-+=\[\]{}<>.,:;\/\\|!?'"`~]+/g;
      const tokens = [];
      const placeholder = (i) => `\u0000${i}\u0000`;

      const masked = line.replace(re, (m) => {
        tokens.push(m);
        return placeholder(tokens.length - 1);
      });

      let reversed = reverseString(masked);
      reversed = reversed.replace(/\u0000(\d+)\u0000/g, (_, n) => tokens[Number(n)]);
      return reversed;
    }

    function convert(text, mode, keepLatinNums) {
      if (!text) return "";
      if (mode === "all") {
        return keepLatinNums ? smartReverseLine(text) : reverseString(text);
      }
      const lines = text.split(/\r?\n/);
      return lines.map(line => keepLatinNums ? smartReverseLine(line) : reverseString(line)).join("\n");
    }

    function getMode() {
      return document.querySelector('input[name="mode"]:checked')?.value || "lines";
    }

    function setStatus(msg, ok = true) {
      const el = $("status");
      el.textContent = msg;
      el.style.color = ok ? "#2b6" : "#c33";
      if (msg) setTimeout(() => { if (el.textContent === msg) el.textContent = ""; }, 2500);
    }

    $("btnConvert").addEventListener("click", () => {
      const input = $("input").value;
      const mode = getMode();
      const keep = $("keepLatinNums").checked;
      $("output").value = convert(input, mode, keep);
      setStatus("הומר ✅");
    });

    $("btnSwap").addEventListener("click", () => {
      const a = $("input").value;
      $("input").value = $("output").value;
      $("output").value = a;
      setStatus("הוחלף ✅");
    });

    $("btnCopy").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText($("output").value || "");
        setStatus("הועתק ללוח ✅");
      } catch {
        setStatus("לא הצלחתי להעתיק (הרשאות דפדפן).", false);
      }
    });

    $("btnClear").addEventListener("click", () => {
      $("input").value = "";
      $("output").value = "";
      setStatus("נוקה ✅");
    });

    $("input").addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key === "Enter") $("btnConvert").click();
    });
  </script>
</body>
</html>
